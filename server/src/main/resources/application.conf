chuti {
  session {
    # Session secret key - MUST be set via environment variable in production
    # Use CHUTI_SESSION_SECRET_KEY environment variable
    secretKey = ${?CHUTI_SESSION_SECRET_KEY}
    accessTTL = "60 minutes"
    refreshTTL = "14 days"
    # Activation and password recovery token expiration
    codeExpirationHours = "7 days"
  }

  db {
    dataSourceClassName = "org.mariadb.jdbc.MariaDbDataSource"
    maximumPoolSize = 10
    dataSource {
      driver = "org.mariadb.jdbc.Driver"
      # Database URL - defaults to localhost if not set
      url = "jdbc:mariadb://localhost:3306/chuti"
      url = ${?CHUTI_DB_URL}
      # Database credentials - MUST be set via environment variables
      user = ${?CHUTI_DB_USER}
      user = ${?chuti.db.dataSource.user}
      password = ${?CHUTI_DB_PASSWORD}
      password = ${?chuti.db.dataSource.password}
    cachePrepStmts = true
    maximumPoolSize = 20
    prepStmtCacheSize = 250
    prepStmtCacheSqlLimit = 2048
  }
  }
  flyway {
    # Migration scripts location (classpath resource path)
    locations = ["classpath:sql"]
    # Whether to automatically run migrations on startup
    enabled = true
    enabled = ${?CHUTI_FLYWAY_ENABLED}
    # Whether to clean the database before running migrations (DANGEROUS - only for development)
    cleanDisabled = true
    cleanDisabled = ${?CHUTI_FLYWAY_CLEAN_DISABLED}
    # Whether to validate migrations on startup
    validateOnMigrate = true
    # Whether to allow mixing transactional and non-transactional statements
    mixed = false
    # Target version to migrate to (empty = latest)
    target = ""
    target = ${?CHUTI_FLYWAY_TARGET}
    # Baseline settings for existing databases
    # Set to true to automatically baseline an existing database on first migration
    baselineOnMigrate = true
    baselineOnMigrate = ${?CHUTI_FLYWAY_BASELINE_ON_MIGRATE}
    # The version to tag the existing schema with when baselining
    # Set to "015" to mark all V001-V015 migrations as already applied
    baselineVersion = "015"
    baselineVersion = ${?CHUTI_FLYWAY_BASELINE_VERSION}
    # Description for the baseline version
    baselineDescription = "Existing database baseline (V001-V015 already applied)"
    baselineDescription = ${?CHUTI_FLYWAY_BASELINE_DESCRIPTION}
  }
    http {
      # HTTP server configuration
      hostName = "0.0.0.0"
      hostName = ${?CHUTI_HTTP_HOST}
      port = 8079
      port = ${?CHUTI_HTTP_PORT}
      staticContentDir = "/home/rleibman/projects/chuti/debugDist"
      staticContentDir = ${?CHUTI_STATIC_CONTENT_DIR}
    }
  smtp {
    host = "192.168.1.5"
    host = ${?CHUTI_SMTP_HOST}
    auth = false
    auth = ${?CHUTI_SMTP_AUTH}
    port = 25
    port = ${?CHUTI_SMTP_PORT}
    startTTLS = false
    startTTLS = ${?CHUTI_SMTP_START_TTLS}
    user = ""
    user = ${?CHUTI_SMTP_USER}
    password = ""
    password = ${?CHUTI_SMTP_PASSWORD}
    webHostname = "localhost:8079"
    webHostname = ${?CHUTI_SMTP_WEB_HOSTNAME}
    fromEmail = "administrator@chuti.fun"
    fromEmail = ${?CHUTI_SMTP_FROM_EMAIL}
    fromName = "DMScreen Administrator"
    fromName = ${?CHUTI_SMTP_FROM_NAME}
    bccEmail = "roberto@leibman.net"
    bccEmail = ${?CHUTI_SMTP_BCC_EMAIL}
  }
  rateLimit {
    enabled = true
    maxRequests = 100
    windowDurationSeconds = 60
  }
  storage {
    # Base directory for all file storage
    baseDir = "/var/chuti/storage"
    baseDir = ${?CHUTI_STORAGE_BASE_DIR}

    # Subdirectories (relative to baseDir)
    imports = "imports"
    images = "images"
    sounds = "sounds"
    video = "video"

    # Maximum image file size in bytes (10 MB default)
    maxImageFileSize = 10485760
    maxImageFileSize = ${?CHUTI_STORAGE_MAX_IMAGE_FILE_SIZE}
  }
  oauth {
    google {
      # Google OAuth 2.0 credentials
      # Obtain from https://console.cloud.google.com/apis/credentials
      clientId = ${?CHUTI_GOOGLE_OAUTH_CLIENT_ID}
      clientSecret = ${?CHUTI_GOOGLE_OAUTH_CLIENT_SECRET}

      # OAuth endpoints (Google's standard URLs)
      authorizationUri = "https://accounts.google.com/o/oauth2/v2/auth"
      tokenUri = "https://oauth2.googleapis.com/token"
      userInfoUri = "https://www.googleapis.com/oauth2/v3/userinfo"

      # Redirect URI - must match Google Console configuration
      redirectUri = "https://www.chuti.fun/oauth/google/callback"
      redirectUri = ${?CHUTI_GOOGLE_OAUTH_REDIRECT_URI}

      # OAuth scopes to request
      scopes = ["openid", "email", "profile"]
  }
  }
  analytics {
    # Number of days to retain analytics events
    retentionDays = 7
    retentionDays = ${?CHUTI_ANALYTICS_RETENTION_DAYS}

    # Interval (in hours) between cleanup runs
    cleanupIntervalHours = 24
    cleanupIntervalHours = ${?CHUTI_ANALYTICS_CLEANUP_INTERVAL_HOURS}
  }
  ai {
    ollama {
      baseUrl = "http://localhost:11434"
      baseUrl = ${?CHUTI_OLLAMA_URL}
      modelName = "llama3.2:1b"  # Base model - rules included in prompt via promptRules()
      modelName = ${?CHUTI_OLLAMA_MODEL}
      temperature = 0.7
      maxTokens = 500
      timeout = "1 minute"              # Outer timeout (ZIO) - safety net
      timeout = ${?CHUTI_OLLAMA_TIMEOUT}
      httpTimeout = "55 seconds"        # Inner timeout (HTTP client) - fires first
      httpTimeout = ${?CHUTI_OLLAMA_HTTP_TIMEOUT}
      useSystemMessage = false  # Rules included in prompt, not via SystemMessage
      useSystemMessage = ${?CHUTI_OLLAMA_USE_SYSTEM_MESSAGE}
      customModel = false  # Using standard model, not custom
      customModel = ${?CHUTI_OLLAMA_CUSTOM_MODEL}
    }
  }
}
