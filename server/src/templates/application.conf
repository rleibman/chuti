chuti {
  session {
    # Session secret key - MUST be set via CHUTI_SESSION_SECRET_KEY environment variable
    # This is configured in /etc/default/chuti-server
    secretKey = ${?CHUTI_SESSION_SECRET_KEY}
    accessTTL = "60 minutes"
    refreshTTL = "14 days"
    # Activation and password recovery token expiration
    codeExpirationHours = "7 days"
  }

  db {
    dataSourceClassName = "org.mariadb.jdbc.MariaDbDataSource"
    maximumPoolSize = 10
    dataSource {
      driver = "org.mariadb.jdbc.Driver"
      # Database configuration from environment variables
      # Set in /etc/default/chuti-server
      url = "jdbc:mariadb://localhost:3306/chuti"
      url = ${?CHUTI_DB_URL}
      user = ${?CHUTI_DB_USER}
      password = ${?CHUTI_DB_PASSWORD}
      cachePrepStmts = true
      maximumPoolSize = 20
      prepStmtCacheSize = 250
      prepStmtCacheSqlLimit = 2048
    }
  }

  flyway {
    # Migration scripts location (classpath resource path)
    locations = ["classpath:sql"]
    # Whether to automatically run migrations on startup
    enabled = true
    enabled = ${?CHUTI_FLYWAY_ENABLED}
    # Whether to clean the database before running migrations (DANGEROUS - only for development)
    cleanDisabled = true
    cleanDisabled = ${?CHUTI_FLYWAY_CLEAN_DISABLED}
    # Whether to validate migrations on startup
    validateOnMigrate = true
    # Whether to allow mixing transactional and non-transactional statements
    mixed = false
    # Target version to migrate to (empty = latest)
    target = ""
    target = ${?CHUTI_FLYWAY_TARGET}
    # Baseline settings for existing databases
    # Set to true to automatically baseline an existing database on first migration
    baselineOnMigrate = true
    baselineOnMigrate = ${?CHUTI_FLYWAY_BASELINE_ON_MIGRATE}
    # The version to tag the existing schema with when baselining
    # Set to "016" to mark all V001-V016 migrations as already applied
    baselineVersion = "016"
    baselineVersion = ${?CHUTI_FLYWAY_BASELINE_VERSION}
    # Description for the baseline version
    baselineDescription = "Existing database baseline (V001-V016 already applied)"
    baselineDescription = ${?CHUTI_FLYWAY_BASELINE_DESCRIPTION}
  }

  http {
    # HTTP server configuration
    hostName = "0.0.0.0"
    hostName = ${?CHUTI_HTTP_HOST}
    port = 8079
    port = ${?CHUTI_HTTP_PORT}
    staticContentDir = "/data/www/www.chuti.fun/html"
    staticContentDir = ${?CHUTI_STATIC_CONTENT_DIR}
  }

  smtp {
    localhost = "mail.leibmanland.com"
    host = "localhost"
    host = ${?CHUTI_SMTP_HOST}
    auth = false
    auth = ${?CHUTI_SMTP_AUTH}
    port = 25
    port = ${?CHUTI_SMTP_PORT}
    startTTLS = false
    startTTLS = ${?CHUTI_SMTP_START_TTLS}
    user = ""
    user = ${?CHUTI_SMTP_USER}
    password = ""
    password = ${?CHUTI_SMTP_PASSWORD}
    webHostname = "www.chuti.fun"
    webHostname = ${?CHUTI_SMTP_WEB_HOSTNAME}
    fromEmail = "administrator@chuti.fun"
    fromEmail = ${?CHUTI_SMTP_FROM_EMAIL}
    fromName = "Chuti Administrator"
    fromName = ${?CHUTI_SMTP_FROM_NAME}
    bccEmail = "roberto@leibman.net"
    bccEmail = ${?CHUTI_SMTP_BCC_EMAIL}
  }

  rateLimit {
    enabled = true
    maxRequests = 100
    windowDurationSeconds = 60
  }

  storage {
    # Base directory for all file storage
    baseDir = "/var/chuti/storage"
    baseDir = ${?CHUTI_STORAGE_BASE_DIR}
    # Subdirectories (relative to baseDir)
    imports = "imports"
    images = "images"
    sounds = "sounds"
    video = "video"
  }

  dndBeyondFileStore = "/var/chuti/fileStore/dndBeyondCharacters"
  initialDataStore = "/var/chuti/data"
  oauth {
    google {
      # Google OAuth 2.0 credentials
      # Obtain from https://console.cloud.google.com/apis/credentials
      clientId = ${?CHUTI_GOOGLE_OAUTH_CLIENT_ID}
      clientSecret = ${?CHUTI_GOOGLE_OAUTH_CLIENT_SECRET}

      # OAuth endpoints (Google's standard URLs)
      authorizationUri = "https://accounts.google.com/o/oauth2/v2/auth"
      tokenUri = "https://oauth2.googleapis.com/token"
      userInfoUri = "https://www.googleapis.com/oauth2/v3/userinfo"

      # Redirect URI - must match Google Console configuration
      redirectUri = "https://www.chuti.fun/oauth/google/callback"
      redirectUri = ${?CHUTI_GOOGLE_OAUTH_REDIRECT_URI}

      # OAuth scopes to request
      scopes = ["openid", "email", "profile"]
    }
  }
}
